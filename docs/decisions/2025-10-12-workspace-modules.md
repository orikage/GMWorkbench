# 2025-10-12: ワークスペースをモジュール化する方針

## 背景
- 既存の `src/workspace.js` は 4,000 行を超え、ウィンドウ管理・オンボーディング・メンテナンスなど異なる責務が1ファイルに集中していた。
- 小さな変更でも巨大な差分が発生し、レビューコストとテスト観点の切り出しが困難になっていた。
- 将来的に PDF 内検索やアウトライン、ノート等の機能を追加し続けると構造的負債が増える懸念があった。

## 選択肢
1. **現状維持** — 既存ファイルを部分的に整理するが、単一ファイル構造は維持。
2. **段階的モジュール化** — UI セクションごとに ES モジュールへ切り出し、`createWorkspace` から組み合わせる。
3. **フレームワーク導入** — React などのコンポーネントフレームワークへ移行し、状態管理を再設計する。

## 決定
- 選択肢 2 を採用し、Vanilla JS を維持したままディレクトリ単位で責務を分割する。
- `workspace/index.js` をエントリポイントとし、`drop-zone`、`file-queue`、`onboarding`、`maintenance`、`canvas` の各モジュールを疎結合で compose する。
- キャンバス内部の細分化は別タスクとして切り出し、今回のリファクタリングでは API の境界線を整えることを優先する。

## 理由
- 既存のテストとイベント API を保ちながら差分を最小限にできる。
- ES モジュールへの分割だけでもコードレビュー単位を縮小でき、今後の責務分割が容易になる。
- フレームワーク移行はコストが高く、現状の UI 要件ではオーバーエンジニアリングである。

## 影響
- `src/workspace/` 配下に 8 ファイルを新設し、`workspace.js` は薄いリダイレクトに変更。
- README / CHANGELOG / TASKS / DECISIONS / reviews を更新してモジュール構成と今後の課題を共有。
- `canvas.js` は依然として大きいが、インポート境界が明確になったことで段階的な分割が可能になった。

## 次のアクション
- **T-129**: キャンバス内のツールバー・検索・ノート管理を個別モジュールへ分割する。
- **T-130**: ワークスペースのカスタムイベント仕様を型定義またはドキュメントで厳密に管理する。
- Playwright のカバレッジ拡張時に新構造へ合わせたテストヘルパーを整備する。
