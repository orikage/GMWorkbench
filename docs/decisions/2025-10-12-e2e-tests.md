# 2025-10-12: E2E テスト自動化の導入判断

## 背景
- 機能追加が進むにつれて手動確認範囲が拡大し、GitHub Pages へデプロイする前に UI 回帰を検出する手段が不足していた。
- ユニットテストでは DOM 上の見た目やイベントの組み合わせを完全に担保できず、重要なユーザーフローをブラウザで再現する仕組みが求められていた。

## 選択肢
- Playwright で静的ビルドを対象に E2E テストを構築する。
- Cypress など別ツールを検討するが、静的配信への適合性と追加依存を最小化したい。
- Storybook + Interaction Test などで UI 単位の回帰検知を行うが、現状はページ全体の導線検証が優先度高と判断。

## 決定
- Playwright を採用し、`pnpm build` した成果物を `pnpm preview` 経由で配信した上でテストを実行する構成を取る。
- 初期シナリオとしてオンボーディングからサンプル PDF を開くまでの流れを自動化し、今後のテストケース追加に備えて共通ヘルパーの土台を用意する。
- GitHub Actions のデプロイワークフローに Playwright のインストールと E2E 実行ステップを組み込み、main へマージするたびに自動検証が走るようにする。
- プレビューサーバーは `--host 0.0.0.0`、テストの `baseURL` は `http://localhost:4173` に固定し、コンテナ環境や CI でも安定して接続できるようにする。

## 影響
- 主要なユーザーフローを自動検証できるようになり、リグレッションを早期に検知できる。
- ブラウザ依存の動作確認を CI 上で行うため、ローカル環境に依存した確認作業の差異を減らせる。
- Playwright の依存導入によりリポジトリサイズは増加するが、`.gitignore` とレポート出力先の整理でノイズを抑えられる。

## フォローアップ
- 今後は PDF 検索やセッションインポートなど複雑な導線を順次テストケースに追加する。
- Linux で不足するシステムライブラリがある場合に備え、README へ Playwright の依存インストールコマンドを追記した。必要に応じて Docker ベースの実行環境も検討する。
