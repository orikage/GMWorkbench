# 2025-10-12: ワークスペースイベント契約を型で管理する方針

## 背景
- `workspace:*` カスタムイベントは UI と外部統合の境界として利用されているが、契約が散在しており暗黙知になりつつあった。
- TypeScript を導入していないため、イベント payload の構造はテストやドキュメントから推測するしかなく、連携コードの保守が不安定だった。
- 将来的に自動化された統合テストや外部連携 SDK を提供する際、イベント名と detail の型を単一の情報源として扱いたかった。

## 決定
- `src/workspace/events-contract.js` に全カスタムイベントの契約（イベント名、bubbles、detail フィールド、説明）を集約し、再利用可能なメタデータとする。
- 同契約から `types/workspace-events.d.ts` を生成し、DOM のイベントマップへ型拡張を提供する。
- 契約オブジェクトは深い階層まで凍結し、テストでイベント名の網羅性と型識別子の妥当性を検証する。

## 理由
- 契約を 1 箇所で管理することで、イベント名の追加や変更を TypeScript / JSDoc / テストすべてに波及させられる。
- 深い凍結とテストにより、ランタイムで契約が意図せず変更されるリスクを最小化できる。
- 型定義を公開することで、外部スクリプトや将来の型付け移行が容易になる。

## 影響
- 新しい契約に含まれないイベント名はテストで検出されるようになった。
- `package.json` に `types` エントリを追加したため、エディタは自動的にイベント型を補完できる。
- タスク T-130 が完了し、イベント契約のメンテナンス責務が明文化された。

## フォローアップ
- キャンバス内部ロジックの分割（T-129）時に、イベント契約をモジュール間で共有して参照漏れを防ぐ。
- 今後イベントが増えた場合は、契約オブジェクトと型定義、テストを同時に更新する運用を継続する。
