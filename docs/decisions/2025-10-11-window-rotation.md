# 2025-10-11: ウィンドウ回転コントロールの導入方針

## 背景
- シナリオによっては横書き・見開き資料・地図など、縦向きのままでは確認しづらい PDF ページが存在する。
- 既存のズーム／ページナビだけでは向きの違いに対応できず、外部ビューアへ切り替える必要があった。

## 目的
- 追加のアプリを開かずに向きを調整できるようにし、GM の作業台から手を離さない。
- 回転操作は 90° 単位のシンプルさを保ち、UI の負荷を増やさない。

## 選択肢
1. **回転操作を実装しない**
   - UI は増えないが、横向き資料での可読性が大幅に低下する。
2. **CSS 変形で疑似的に回転**
   - 実装は軽いが、pdf.js のキャンバス座標とズレが生じ、将来の注釈／選択機能への拡張が難しい。
3. **pdf.js の `rotation` パラメータで描画** ← 採用
   - 公式 API で 90° 単位の回転を提供しており、レンダリングとイベントの一貫性を維持できる。

## 決定
- ウィンドウツールバーに回転パネル（↺ / ↻ / 0°）を追加し、90° 刻みで回転・リセットできるようにする。
- `workspace:window-rotation-change` を新設し、`rotation` と併せて `page` `zoom` を外部へ通知する。
- 回転状態は IndexedDB に保存し、複製・復元・イベント詳細に含める。

## 影響
- ズーム UI を回転パネルと並列に配置するため、ツールバーの右端レイアウトを再構成した。
- `workspace:window-page-change` と `workspace:window-zoom-change` の詳細に `rotation` を追加し、監視処理が常に最新角度へアクセスできるようにした。
- テストでは回転イベント・永続化・複製時の角度維持をカバーし、回転が他の機能を壊さないことを保証する。
