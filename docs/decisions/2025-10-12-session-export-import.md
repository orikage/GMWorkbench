# 2025-10-12: セッション書き出し/読み込みの導入判断

## 背景
- IndexedDB 永続化によってブラウザ再訪時に状態を復元できるようになったが、別ブラウザやPCへ持ち出す方法がなく、セッションのバックアップに不安が残っていた。
- 複数 GM 間でレイアウトを共有したいケースや、イベント前に状態を保存しておきたいという要望が上がっていた。

## 選択肢
- 既存の永続化レイヤーを拡張し、JSON 形式でスナップショットをエクスポート/インポートする。
- ローカルファイルシステムアクセス API を検討するが、ブラウザ対応状況や権限付与の複雑さが課題となる。
- クラウド同期を提供するが、プロジェクト方針である「Local first」に反するため候補から外す。

## 決定
- IndexedDB から収集したウィンドウ情報と PDF バイナリを base64 へ変換し、1ファイルの JSON にまとめてダウンロードする方式を採用する。
- インポート時は既存ウィンドウを安全にクローズしてからスナップショットを展開し、読み込み進行状況や失敗時のエラーを UI に明示する。
- UI からの操作は `workspace:session-exported` / `workspace:session-imported` で外部へ通知し、オートメーションやログ収集に備える。

## 影響
- 別端末やブラウザ間でも PDF 配置とメモを移動できるようになり、セッション前の準備やバックアップ体験が大幅に改善される。
- スナップショットは JSON + base64 のみで構成されるため、Git など既存のファイル管理にも載せやすい。
- 取り込み失敗時のエラーハンドリングが明確になり、壊れたファイルで状態が半端に残る事態を避けられる。

## フォローアップ
- 将来的にウィンドウを選択的に書き出す機能や、読み込み前に差分をプレビューできる UI の検討を続ける。
- 大容量 PDF を含むセッションではファイルサイズが大きくなるため、必要に応じて zip 圧縮などの最適化を検討する。
